<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>使用certbot申请域名证书</title>
    <link href="/2024/11/14/domain-certificate/"/>
    <url>/2024/11/14/domain-certificate/</url>
    
    <content type="html"><![CDATA[<h3 id="安装certbot"><a href="#安装certbot" class="headerlink" title="安装certbot"></a>安装certbot</h3><blockquote><p><em>Certbot 是一个开源工具，旨在简化获取和管理 SSL&#x2F;TLS 证书的过程。由电子前哨基金会（EFF）开发，它可以自动化证书的申请、续期和配置，使得网站能够更容易地实现 HTTPS 加密。</em></p></blockquote><h4 id="执行安装命令"><a href="#执行安装命令" class="headerlink" title="执行安装命令"></a>执行安装命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update &amp;&amp; <span class="hljs-built_in">sudo</span> apt install certbot<br></code></pre></td></tr></table></figure><h4 id="检查是否安装成功"><a href="#检查是否安装成功" class="headerlink" title="检查是否安装成功"></a>检查是否安装成功</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">certbot --version<br></code></pre></td></tr></table></figure><h4 id="一些简单的certbot命令"><a href="#一些简单的certbot命令" class="headerlink" title="一些简单的certbot命令"></a>一些简单的certbot命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 申请证书</span><br><span class="hljs-built_in">sudo</span> certbot certonly --manual --preferred-challenges dns -d domain.com<br><br><span class="hljs-comment"># 查看证书详情</span><br><span class="hljs-built_in">sudo</span> certbot certificates<br><br><span class="hljs-comment"># 续期证书</span><br><span class="hljs-built_in">sudo</span> certbot renew<br><br><span class="hljs-comment"># 查看证书到期时间</span><br><span class="hljs-built_in">sudo</span> certbot certificates<br></code></pre></td></tr></table></figure><h3 id="使用certbot申请域名证书"><a href="#使用certbot申请域名证书" class="headerlink" title="使用certbot申请域名证书"></a>使用certbot申请域名证书</h3><h4 id="执行命令（申请之前最好关闭nginx）"><a href="#执行命令（申请之前最好关闭nginx）" class="headerlink" title="执行命令（申请之前最好关闭nginx）"></a>执行命令（申请之前最好关闭nginx）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> certbot certonly --standalone -d domain.com -d www.domain.com<br></code></pre></td></tr></table></figure><blockquote><p><em>每个子域名使用-d参数添加，这条命令就是为<code>domain.com</code>、<code>www.domain.com</code>这两个域名申请证书，申请证书完成之后证书会默认存在在&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;目录。</em></p></blockquote><h4 id="使用certbot申请通配证书"><a href="#使用certbot申请通配证书" class="headerlink" title="使用certbot申请通配证书"></a>使用certbot申请通配证书</h4><p>确保你要申请证书的域名已经指向你的服务器。你可以在 DNS 设置中添加 A 记录或 CNAME 记录来将域名指向你的服务器。</p><p>执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">certbot certonly --manual<br></code></pre></td></tr></table></figure><p>它会让你输入需要申请的域名，示例输入*.domain.com：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@www:~# certbot certonly --manual<br>Saving debug <span class="hljs-built_in">log</span> to /var/log/letsencrypt/letsencrypt.log<br>Plugins selected: Authenticator manual, Installer None<br>Please enter <span class="hljs-keyword">in</span> your domain name(s) (comma and/or space separated)  (Enter <span class="hljs-string">&#x27;c&#x27;</span><br>to cancel): *.domain.com<br>Obtaining a new certificate<br>Performing the following challenges:<br>dns-01 challenge <span class="hljs-keyword">for</span> domain.com<br></code></pre></td></tr></table></figure><p>接着会有一个询问你是否同意记录你的IP，输入:Y</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>NOTE: The IP of this machine will be publicly logged as having requested this<br>certificate. If you<span class="hljs-string">&#x27;re running certbot in manual mode on a machine that is not</span><br><span class="hljs-string">your server, please ensure you&#x27;</span>re okay with that.<br><br>Are you OK with your IP being logged?<br>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>(Y)es/(N)o: Y<br></code></pre></td></tr></table></figure><p>同意之后会给你一个域名的DNS记录，需要你添加到你的域名的DNS记录中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>Please deploy a DNS TXT record under the name<br>_acme-verify.domain.com with the following value:<br><br>ObcPAGKjw7BUdyEz1d7cOTbogLRILWFKhk<br><br>Before continuing, verify the record is deployed.<br>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>Press Enter to Continue<br>Waiting <span class="hljs-keyword">for</span> verification...<br>Cleaning up challenges<br></code></pre></td></tr></table></figure><p>这里需要你添加的DNS记录为：</p><ul><li>类型：TXX</li><li>名称：_acme-verify</li><li>内容：ObcPAGKjw7BUdyEz1d7cOTbogLRILWFKhk</li></ul><p>在你的域名托管服务商（例如:cloudflare）添加完成DNS记录之后，再回到服务器终端按下Enter确认继续，它会验证你是否已经按照要求添加DNS记录了，不出意外的话，你将看到以下信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">IMPORTANT NOTES:<br> - Congratulations! Your certificate and chain have been saved at:<br>   /etc/letsencrypt/live/domain.com/fullchain.pem<br>   Your key file has been saved at:<br>   /etc/letsencrypt/live/domain.com/privkey.pem<br>   Your cert will expire on 2024-08-13. To obtain a new or tweaked<br>   version of this certificate <span class="hljs-keyword">in</span> the future, simply run certbot<br>   again. To non-interactively renew *all* of your certificates, run<br>   <span class="hljs-string">&quot;certbot renew&quot;</span><br> - If you like Certbot, please consider supporting our work by:<br><br>   Donating to ISRG / Let<span class="hljs-string">&#x27;s Encrypt:   https://letsencrypt.org/donate</span><br><span class="hljs-string">   Donating to EFF:                    https://eff.org/donate-le</span><br></code></pre></td></tr></table></figure><p>表示你的证书已经申请成功了</p>]]></content>
    
    
    
    <tags>
      
      <tag>证书</tag>
      
      <tag>域名</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
